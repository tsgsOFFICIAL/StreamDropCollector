<UserControl x:Class="UI.Views.InventoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:local="clr-namespace:UI"
             mc:Ignorable="d"
             d:DesignHeight="900" d:DesignWidth="1200"
             Background="{DynamicResource MainBackgroundBrush}">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <TextBlock Text="Inventory"
               FontSize="30"
               FontWeight="Bold"
               Foreground="{DynamicResource TextPrimaryBrush}"
               Margin="0,0,0,20"/>

        <!-- CAMPAIGNS LIST -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding ActiveCampaigns}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{DynamicResource CardBackgroundBrush}"
                                CornerRadius="12"
                                Margin="0,0,0,20"
                                Padding="20"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1">

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Game Image -->
                                <Border Width="100" Height="100" CornerRadius="10">
                                    <Border.Background>
                                        <SolidColorBrush Color="{DynamicResource CardBackgroundColor}"/>
                                    </Border.Background>

                                    <Border.Clip>
                                        <RectangleGeometry RadiusX="10" RadiusY="10" Rect="0,0,100,100"/>
                                    </Border.Clip>
                                    
                                    <Image local:ImageEx.SourceUrl="{Binding GameImageUrl}" Stretch="UniformToFill" RenderOptions.BitmapScalingMode="HighQuality"/>
                                </Border>                                

                                <!-- Campaign Info -->
                                <StackPanel Grid.Column="1" Margin="20,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding GameName}"
                                               FontSize="22"
                                               FontWeight="Bold"
                                               Foreground="{DynamicResource TextPrimaryBrush}"/>

                                    <TextBlock Text="{Binding Name}"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextMutedBrush}"
                                               Margin="0,4,0,10"/>

                                    <!-- Platform Badge + End Time -->
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <!-- Platform Badge — Kick = default (green), Twitch = purple -->
                                        <Border CornerRadius="6" Padding="10,4">
                                            <Border.Background>
                                                <SolidColorBrush Color="{DynamicResource KickGreen}"/>
                                                <!-- #5FF41C -->
                                            </Border.Background>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Platform}" Value="Twitch">
                                                            <Setter Property="Background" Value="{DynamicResource TwitchBrush}"/>
                                                            <!-- #9146FF -->
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <TextBlock Text="{Binding Platform}"
                                                   FontWeight="Bold"
                                                   Foreground="Black"
                                                   FontSize="11"/>
                                        </Border>

                                        <TextBlock Margin="15,0,0,0" Foreground="#FF6666">
                                            <Run Text="Ends "/>
                                            <Run Text="{Binding EndsAt, StringFormat=MMM dd • HH:mm}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Rewards List -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Top" MinWidth="320">
                                    <TextBlock Text="Rewards"
                                               FontSize="14"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               Margin="0,0,0,8"/>

                                    <ItemsControl ItemsSource="{Binding Rewards}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="{DynamicResource BorderBrush}"
                                                        CornerRadius="8"
                                                        Margin="0,0,0,8"
                                                        Padding="12">

                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <!-- Reward Image -->
                                                        <Border Grid.Column="0" Width="50" Height="50" CornerRadius="6">
                                                            <Border.Background>
                                                                <SolidColorBrush Color="{DynamicResource CardBackgroundColor}"/>
                                                            </Border.Background>
                                                            
                                                            <Border.Clip>
                                                                <RectangleGeometry RadiusX="6" RadiusY="6" Rect="0,0,50,50"/>
                                                            </Border.Clip>
                                                            
                                                            <Image local:ImageEx.SourceUrl="{Binding ImageUrl}" Stretch="UniformToFill"/>
                                                        </Border>

                                                        <!-- Name + Progress -->
                                                        <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                                                            <TextBlock Text="{Binding Name}"
                                                                       FontWeight="Bold"
                                                                       Foreground="{DynamicResource AccentBrush}"/>

                                                            <TextBlock Margin="0,6,0,0" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold">
                                                                <Run Text="{Binding ProgressMinutes}" Foreground="{DynamicResource AccentBrush}"/>
                                                                <Run Text=" / "/>
                                                                <Run Text="{Binding RequiredMinutes}"/>
                                                                <Run Text=" min"/>
                                                            </TextBlock>

                                                            <!-- Progress Bar -->
                                                            <ProgressBar Value="{Binding ProgressMinutes}"
                                                                         Maximum="{Binding RequiredMinutes}"
                                                                         Height="8"
                                                                         Margin="0,8,0,0"
                                                                         Foreground="{DynamicResource AccentBrush}"
                                                                         Background="#333333"/>
                                                        </StackPanel>

                                                        <!-- CLAIMED Badge -->
                                                        <Border Grid.Column="2" Background="{DynamicResource AccentBrush}"
                                                                CornerRadius="6"
                                                                Padding="8,4"
                                                                Margin="10,0,0,0"
                                                                Visibility="{Binding IsClaimed, Converter={StaticResource InverseBooleanConverter}}">
                                                            <TextBlock Text="CLAIMED"
                                                                       FontWeight="Bold"
                                                                       FontSize="10"
                                                                       Foreground="{DynamicResource MainBackgroundBrush}"/>
                                                        </Border>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>

                <!-- EMPTY STATE — 100% SAFE -->
                <ItemsControl.Style>
                    <Style TargetType="ItemsControl">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate>
                                    <ItemsPresenter/>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ActiveCampaigns.Count}" Value="0">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate>
                                            <TextBlock Text="No active drops campaigns"
                                                       FontSize="26"
                                                       Foreground="{DynamicResource TextMutedBrush}"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"/>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ItemsControl.Style>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>